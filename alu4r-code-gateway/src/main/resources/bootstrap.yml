server:
  port: 9999
spring:
  application:
    name: @artifactId@
  cloud:
    nacos:
      discovery:
        server-addr: 127.0.0.1:8848
      config:
        server-addr: ${spring.cloud.nacos.discovery.server-addr}
        file-extension: yml

#下面文件可以放在nacos得配置中心
---
spring:
  redis:
    host: 47.100.58.237
    password: redis//4142
    port: 6379
  cloud:
    gateway:
      discovery:
        locator:
          enabled: true  #从注册中心动态创建路由，以微服务名进行路由
      globalcors:
        cors-configurations:
          '[/**]':
            allowCredentials: true
            allowedOrigins: "*"
            allowedMethods: "*"
            allowedHeaders: "*"
      routes:
        #nacos
        - id: jeecg-cloud-demo-biz
          uri: lb://jeecg-cloud-demo-biz
          predicates:
            - Path=/demo/**
          #限流配置
          filters:
            - name: RequestRateLimiter
              args:
                key-resolver: '#{@ipKeyResolver}'
                redis-rate-limiter.replenishRate: 10
                redis-rate-limiter.burstCapacity: 20
            #降级配置
            - name: Hystrix
              args:
                name: default
                fallbackUri: 'forward:/fallback'
        - id: alu4r-code-system-biz
          uri: lb://alu4r-code-system-biz
          predicates:
            - Path=/sys/**,/test/**,/online/**,/api/**,/big/screen/**,/bigscreen/**,/webSocketApi/**,/message/**
          #限流配置
          filters:
            - name: RequestRateLimiter
              args:
                key-resolver: '#{@ipKeyResolver}'
                redis-rate-limiter.replenishRate: 10 #令牌桶每秒填充平均速率
                redis-rate-limiter.burstCapacity: 20 #令牌桶总容量
            #降级配置
            - name: Hystrix
              args:
                name: default
                fallbackUri: 'forward:/fallback'
        - id: jeecg-cloud-websocket
          uri: lb:ws://alu4r-code-system-biz
          predicates:
            - Path=/websocket/**
management:
  endpoints:
    web:
      exposure:
        include: '*'
# hystrix 信号量隔离，3秒后自动超时
hystrix:
  command:
    default:
      execution:
        isolation:
          strategy: SEMAPHORE
          thread:
            timeoutInMilliseconds: 3000
  shareSecurityContext: true
# 验证配置生效
jeecg:
  test: 123456